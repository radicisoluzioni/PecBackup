# PEC Archiver Configuration Example
# Copy this file to config.yaml and customize it

# Base path for archive storage
base_path: /data/pec-archive

# Backup mode: "standard" or "s3_sync"
# - standard: Compress and keep archives locally with date-based folder structure (default)
# - s3_sync: Store emails locally in direct mailbox mirror (no date folders), 
#            upload daily archives to S3 with date organization, then delete only the archives
#            (local emails are never deleted - cumulative mirror)
backup_mode: standard

# Number of concurrent workers for processing accounts
concurrency: 4

# Retry policy for failed operations
retry_policy:
  max_retries: 3
  initial_delay: 5  # seconds
  backoff_multiplier: 2  # exponential backoff

# IMAP settings
imap:
  timeout: 30  # seconds
  batch_size: 100  # messages per batch

# Scheduler settings
scheduler:
  # Time to run the daily archive (HH:MM format)
  run_time: "01:00"

# S3 configuration (required when backup_mode is "s3_sync")
# Uncomment and configure if using s3_sync mode
#
# For AWS S3:
#s3:
#  # S3 bucket name (required)
#  bucket: my-pec-backups
#  
#  # AWS region (required)
#  region: eu-west-1
#  
#  # S3 key prefix for organizing backups (optional, defaults to "pec-backups")
#  prefix: pec-backups
#  
#  # AWS credentials (optional - can use IAM roles, environment variables, or ~/.aws/credentials)
#  aws_access_key_id: ${AWS_ACCESS_KEY_ID}
#  aws_secret_access_key: ${AWS_SECRET_ACCESS_KEY}
#
# For Hetzner Object Storage (S3-compatible):
#s3:
#  # S3 bucket name (required)
#  bucket: my-pec-backups
#  
#  # Region (use any valid region name, e.g., eu-central-1)
#  region: eu-central-1
#  
#  # Custom endpoint URL for Hetzner S3 (required for Hetzner)
#  # Format: https://<your-bucket-name>.s3.<region>.hetzner.cloud
#  endpoint_url: https://my-pec-backups.s3.eu-central-1.hetzner.cloud
#  
#  # S3 key prefix for organizing backups (optional, defaults to "pec-backups")
#  prefix: pec-backups
#  
#  # Hetzner Object Storage credentials (required)
#  # Note: Hetzner uses AWS-compatible field names for S3 credentials
#  aws_access_key_id: ${AWS_ACCESS_KEY_ID}
#  aws_secret_access_key: ${AWS_SECRET_ACCESS_KEY}

# Email notification settings
# Configure to receive daily backup reports and error alerts
notifications:
  # Enable or disable notifications (true/false)
  enabled: false
  
  # When to send notifications:
  # - "always": Send notification after every backup (success or error)
  # - "error": Send notification only when errors occur
  send_on: "always"
  
  # Email recipients (single address or list of addresses)
  recipients:
    - admin@example.com
    - backup-alerts@example.com
  # Or use a single recipient:
  # recipients: admin@example.com
  
  # SMTP server configuration
  smtp:
    host: smtp.example.com
    port: 587  # Use 587 for TLS, 465 for SSL
    username: ${SMTP_USERNAME}  # Use environment variable
    password: ${SMTP_PASSWORD}  # Use environment variable
    sender: pec-archiver@example.com  # Optional, defaults to username
    use_tls: true  # Use STARTTLS (port 587), set false for SSL (port 465)

# PEC accounts to archive
accounts:
  - username: account1@pec.it
    password: ${PEC_PASSWORD_1}  # Use environment variable
    host: imaps.pec.aruba.it
    port: 993
    folders:
      - INBOX
      - Posta inviata
  
  - username: account2@pec.it
    password: ${PEC_PASSWORD_2}
    host: imaps.pec.aruba.it
    port: 993
    folders:
      - INBOX
      - Posta inviata
